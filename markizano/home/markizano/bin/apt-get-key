#!/bin/bash

if [ $UID != 0 ]; then
	echo -e "\033[33mERROR\033[00m: This script can only be run by root!";
	exit 1;
fi

function Usage(){
	cat <<EOF
Usage: apt-get-key [key] [file]
key    - The key to request from the gpg server.
file   - Where to put the key after it's been requested and generated.
EOF
	exit 8;
}

KEY=$1;
FILE=$2;

if [ -n "$( echo $1 | grep -P -- '--?h(elp)?' )" ] || [ -z $KEY ] || [ -z $FILE ]; then
	Usage;
fi

if [ ! -d $(dirname $FILE) ]; then
	echo -e "\033[31mERROR\033[00m: $(basename $0): Cannot stat \`$FILE' no such directory.";
	exit 1;
fi

gpg --keyserver subkeys.pgp.net --recv $KEY && gpg --export --armor $KEY | tee $FILE;
apt-key add "$FILE";
echo -e "\033[32mDone.\033[00m";
