#!/bin/php -c /etc/php5/php.ini
<?php

$SELF = basename($_SERVER['argv'][0]);
unset($_SERVER['argv'][0]);
$argv = $_SERVER['argv'];
$GLOBALS['err'] = 0;

function Usage(){
	echo <<<EOF
Usage: $SELF: [file] [file] [file]
Automatically resizes all images to 800x600, and overwrites their contents.\n
EOF
;
	die(8);
}

function resizeImage($image){
	if(!realpath($pic) || !file_exists($pic) || !is_file($pic)){
		file_put_contents('php:/'.'/stderr', "\033[31mError\033[00m: Cannot stat `$pic', no such file or directory.");
		++$GLOBALS['err'];
		continue;
	}
	$image = new Imagick($pic);
	$image->resizeImage(800, 600, imagick::FILTER_QUADRATIC);
	file_put_contents($pic, $image->toString());
}

if(!isset($argv[1]) || preg_match('/--?h(elp)?/i', $argv[1])){
	Usage();
}

if(count($argv) > 1){
	foreach($argv as $pic){
		resizeImage($pic);
	}
}else{
	resizeImage($argv[1]);
}
exit($GLOBALS['err']);
